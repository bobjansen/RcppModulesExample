---
title: "Rcpp Modules HOWTO"
author: "Bob Jansen"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Rcpp_Modules_HOWTO}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE}
library(RcppModulesExample)
```

# Introduction

The aim of this vignette is to describe all the aspects of Rcpp Modules, from
the very basic to the more advanced. If your not familiar with Rcpp please refer
to Allaire, Eddelbuettel and Francois (2017). Some C++ knowledge is assumed
but only at a basic level. I'm not a C++ expert either (I did get advice
though). Stubbornness might help. The code does not include any functionality
except for printing and multiplying strings by design. The only goal of the
package is to give minimal examples of all Rcpp Modules features. This vignette
is contained in a fully functional Rcpp package.

The following sections contain a step by step guide of creating the package,
starting with the most basic features.

All steps can be referred to by their own branch, to get to the first step
check out branch `Step1`
```{bash, eval = FALSE}
git checkout Step1
```
and so on. _Branches have not been created yet._

# Step 0: Creating an Rcpp package

If Rcpp is not yet installed, install it. Now you can create a package skeleton
that is ready to use Rcpp with the following command:

```{r, eval = FALSE}
#install.packages('Rcpp')
Rcpp::Rcpp.package.skeleton(
  name = 'RcppModulesExample',
  # Note that Rcpp itself comes with examples as well which we don't use.
  module = FALSE,
  example_code = FALSE,
  author = "Bob Jansen",
  email = "bobjansen@hey.com"
)
```

# Step 1: Creating a function

The simplest way to run C++ code from R is by using functions. Suppose we want
to expose the following function (the source can be found in `src/step1.cpp`):

```{cpp, eval = FALSE}
#include <Rcpp.h>
using namespace Rcpp;

void echo(StringVector message) {
  Rcpp::Rcout << message << std::endl;
}
```
We need to define a module in C++ and then load the module into R. To create
the module use the aptly named `RCPP_MODULE` macro
```{cpp, eval = FALSE}
RCPP_MODULE(step1_module) {
  function("echo", &echo)
}
```

Note that if your goal is to just expose a number of C++-functions to R, it
will probably be easier to use Rcpp attributes.
